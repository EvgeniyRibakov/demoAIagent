# ‚úÖ –®–∞–±–ª–æ–Ω —Å–∞–º–æ–ø—Ä–æ–≤–µ—Ä–∫–∏ AI-–∞–≥–µ–Ω—Ç–∞ v2.0

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ü—Ä–æ–≥—Ä–∞–º–º–Ω—ã–µ —á–µ–∫–ª–∏—Å—Ç—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ –æ—Ç—á–µ—Ç–∞  
**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 15 –æ–∫—Ç—è–±—Ä—è 2025  
**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:** –ü–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º push –≤ GitHub

---

## üéØ –ö–æ–Ω—Ü–µ–ø—Ü–∏—è

**–ü—Ä–æ–±–ª–µ–º–∞:** LLM –Ω–µ –º–æ–∂–µ—Ç "—Ä–µ–∞–ª—å–Ω–æ" —Å–µ–±—è –ø—Ä–æ–≤–µ—Ä–∏—Ç—å - –æ–Ω –¥—É–º–∞–µ—Ç —á—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏–ª, –Ω–æ –º–æ–∂–µ—Ç –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å –æ—à–∏–±–∫–∏.

**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≥—Ä–∞–º–º–Ω—ã–µ —á–µ–∫–ª–∏—Å—Ç—ã —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º–∏ –∫—Ä–∏—Ç–µ—Ä–∏—è–º–∏, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å.

---

## üìã –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–≤–µ—Ä–æ–∫

### –£—Ä–æ–≤–µ–Ω—å 1: –ë–∞–∑–æ–≤—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –í—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–∞—Ç—ã –Ω–∞–π–¥–µ–Ω—ã
- ‚úÖ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—Ç—Ä–∏–∫ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –æ–∂–∏–¥–∞–µ–º–æ–º—É
- ‚úÖ –ù–µ—Ç –∞–Ω–æ–º–∞–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π (¬±500%)
- ‚úÖ –í—Å–µ —á–∏—Å–ª–∞ –≤ —Ä–∞–∑—É–º–Ω—ã—Ö –ø—Ä–µ–¥–µ–ª–∞—Ö

### –£—Ä–æ–≤–µ–Ω—å 2: –ü—Ä–æ–≤–µ—Ä–∫–∏ –ª–æ–≥–∏–∫–∏
- ‚úÖ –í—Å–µ –ø—Ä–∞–≤–∏–ª–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã
- ‚úÖ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã —Ä–∞—Å—Å—Ç–∞–≤–ª–µ–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –ø—Ä–∞–≤–∏–ª–∞–º
- ‚úÖ –ù–µ—Ç –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏–π –≤ –≤—ã–≤–æ–¥–∞—Ö

### –£—Ä–æ–≤–µ–Ω—å 3: –ü—Ä–æ–≤–µ—Ä–∫–∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- ‚úÖ –í—Å–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –≤–∞–ª–∏–¥–Ω—ã
- ‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Ç—á–µ—Ç–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —à–∞–±–ª–æ–Ω—É
- ‚úÖ –ù–µ—Ç –ø—É—Å—Ç—ã—Ö —Å–µ–∫—Ü–∏–π
- ‚úÖ Markdown —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω

---

## üíª –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞ Python

### 1. –ë–∞–∑–æ–≤—ã–π —á–µ–∫–ª–∏—Å—Ç

```python
class ReportValidator:
    """–í–∞–ª–∏–¥–∞—Ç–æ—Ä –æ—Ç—á–µ—Ç–∞ —Å –ø—Ä–æ–≥—Ä–∞–º–º–Ω—ã–º–∏ –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏"""
    
    def __init__(self, report_data):
        self.data = report_data
        self.errors = []
        self.warnings = []
    
    def validate_all(self):
        """–ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏"""
        self.check_dates()
        self.check_metrics()
        self.check_values()
        self.check_sources()
        self.check_recommendations()
        self.check_format()
        
        return {
            'passed': len(self.errors) == 0,
            'errors': self.errors,
            'warnings': self.warnings,
            'score': self.calculate_score()
        }
    
    def check_dates(self):
        """–ü—Ä–æ–≤–µ—Ä–∫–∞ 1: –î–∞—Ç—ã –Ω–∞–π–¥–µ–Ω—ã –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã"""
        if not self.data.get('today_date'):
            self.errors.append("–ö–†–ò–¢–ò–ß–ù–û: –î–∞—Ç–∞ '—Å–µ–≥–æ–¥–Ω—è' –Ω–µ –Ω–∞–π–¥–µ–Ω–∞")
        
        if not self.data.get('yesterday_date'):
            self.errors.append("–ö–†–ò–¢–ò–ß–ù–û: –î–∞—Ç–∞ '–≤—á–µ—Ä–∞' –Ω–µ –Ω–∞–π–¥–µ–Ω–∞")
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ –¥–∞—Ç—ã –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã
        if self.data.get('today_date') and self.data.get('yesterday_date'):
            from datetime import datetime, timedelta
            today = datetime.strptime(self.data['today_date'], '%d.%m.%Y')
            yesterday = datetime.strptime(self.data['yesterday_date'], '%d.%m.%Y')
            
            if (today - yesterday).days != 1:
                self.warnings.append(
                    f"–í–ù–ò–ú–ê–ù–ò–ï: –†–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É –¥–∞—Ç–∞–º–∏ –Ω–µ 1 –¥–µ–Ω—å: "
                    f"{today} vs {yesterday}"
                )
    
    def check_metrics(self):
        """–ü—Ä–æ–≤–µ—Ä–∫–∞ 2: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –º–µ—Ç—Ä–∏–∫"""
        metrics = self.data.get('metrics', [])
        
        if len(metrics) == 0:
            self.errors.append("–ö–†–ò–¢–ò–ß–ù–û: –ù–µ –Ω–∞–π–¥–µ–Ω–æ –Ω–∏ –æ–¥–Ω–æ–π –º–µ—Ç—Ä–∏–∫–∏")
        
        if len(metrics) < 10:
            self.warnings.append(
                f"–í–ù–ò–ú–ê–ù–ò–ï: –ù–∞–π–¥–µ–Ω–æ —Ç–æ–ª—å–∫–æ {len(metrics)} –º–µ—Ç—Ä–∏–∫, "
                f"–æ–∂–∏–¥–∞–ª–æ—Å—å >30"
            )
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç
        required_metrics = ['CR', 'CTR', '–ü–æ–∫–∞–∑—ã', '–ö–ª–∏–∫–∏', '–ó–∞–∫–∞–∑—ã']
        found_metrics = [m['name'] for m in metrics]
        
        for required in required_metrics:
            if not any(required.lower() in m.lower() for m in found_metrics):
                self.warnings.append(
                    f"–í–ù–ò–ú–ê–ù–ò–ï: –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è –º–µ—Ç—Ä–∏–∫–∞ '{required}' –Ω–µ –Ω–∞–π–¥–µ–Ω–∞"
                )
    
    def check_values(self):
        """–ü—Ä–æ–≤–µ—Ä–∫–∞ 3: –ó–Ω–∞—á–µ–Ω–∏—è –≤ —Ä–∞–∑—É–º–Ω—ã—Ö –ø—Ä–µ–¥–µ–ª–∞—Ö"""
        for metric in self.data.get('metrics', []):
            change_pct = metric.get('change_percent', 0)
            
            # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∞–Ω–æ–º–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
            if abs(change_pct) > 200:
                self.errors.append(
                    f"–ö–†–ò–¢–ò–ß–ù–û: –ê–Ω–æ–º–∞–ª—å–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ {metric['name']}: "
                    f"{change_pct}% (–≤–µ—Ä–æ—è—Ç–Ω–æ –æ—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞)"
                )
            
            # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
            if abs(change_pct) > 100:
                self.warnings.append(
                    f"–í–ù–ò–ú–ê–ù–ò–ï: –ë–æ–ª—å—à–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ {metric['name']}: "
                    f"{change_pct}% (–ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å)"
                )
            
            # –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ –∑–Ω–∞—á–µ–Ω–∏—è –Ω–µ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ (–≥–¥–µ –Ω–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å)
            if metric.get('today_value') < 0:
                non_negative_keywords = ['–ø–æ–∫–∞–∑—ã', '–∫–ª–∏–∫–∏', '–∑–∞–∫–∞–∑—ã', '–≤—ã—Ä—É—á–∫–∞']
                if any(kw in metric['name'].lower() for kw in non_negative_keywords):
                    self.errors.append(
                        f"–ö–†–ò–¢–ò–ß–ù–û: –û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è {metric['name']}: "
                        f"{metric['today_value']}"
                    )
    
    def check_sources(self):
        """–ü—Ä–æ–≤–µ—Ä–∫–∞ 4: –°—Å—ã–ª–∫–∏ –Ω–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã"""
        for metric in self.data.get('metrics', []):
            source = metric.get('source')
            
            if not source:
                self.warnings.append(
                    f"–í–ù–ò–ú–ê–ù–ò–ï: –ù–µ—Ç —Å—Å—ã–ª–∫–∏ –Ω–∞ –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–ª—è {metric['name']}"
                )
                continue
            
            # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ —Å—Å—ã–ª–∫–∏
            if not self._validate_cell_reference(source):
                self.errors.append(
                    f"–ö–†–ò–¢–ò–ß–ù–û: –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Å—Å—ã–ª–∫–∞ –Ω–∞ –∏—Å—Ç–æ—á–Ω–∏–∫: {source}"
                )
    
    def check_recommendations(self):
        """–ü—Ä–æ–≤–µ—Ä–∫–∞ 5: –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –ø—Ä–∞–≤–∏–ª–∞–º"""
        critical_issues = [
            m for m in self.data.get('metrics', []) 
            if m.get('severity') == 'critical'
        ]
        
        for issue in critical_issues:
            if not issue.get('recommendation'):
                self.errors.append(
                    f"–ö–†–ò–¢–ò–ß–ù–û: –ù–µ—Ç —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω–æ–π –ø—Ä–æ–±–ª–µ–º—ã: "
                    f"{issue['name']}"
                )
            
            if not issue.get('rule_id'):
                self.warnings.append(
                    f"–í–ù–ò–ú–ê–ù–ò–ï: –ù–µ —É–∫–∞–∑–∞–Ω–æ –ø—Ä–∞–≤–∏–ª–æ –¥–ª—è {issue['name']}"
                )
    
    def check_format(self):
        """–ü—Ä–æ–≤–µ—Ä–∫–∞ 6: –§–æ—Ä–º–∞—Ç –æ—Ç—á–µ—Ç–∞ –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω"""
        report_text = self.data.get('report_markdown', '')
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö —Å–µ–∫—Ü–∏–π
        required_sections = [
            '# –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –∞–Ω–∞–ª–∏–∑',
            '## üî¥ –ö–†–ò–¢–ò–ß–ù–û',
            '## üü° –í–ê–ñ–ù–û',
            '## üü¢ –ù–û–†–ú–ê',
            '## ‚úÖ –°–∞–º–æ–ø—Ä–æ–≤–µ—Ä–∫–∞ –∞–≥–µ–Ω—Ç–∞'
        ]
        
        for section in required_sections:
            if section not in report_text:
                self.errors.append(
                    f"–ö–†–ò–¢–ò–ß–ù–û: –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è —Å–µ–∫—Ü–∏—è: {section}"
                )
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ –Ω–µ—Ç –ø—É—Å—Ç—ã—Ö —Å–µ–∫—Ü–∏–π
        if '## üî¥ –ö–†–ò–¢–ò–ß–ù–û\n\n##' in report_text:
            self.warnings.append(
                "–í–ù–ò–ú–ê–ù–ò–ï: –°–µ–∫—Ü–∏—è –ö–†–ò–¢–ò–ß–ù–û –ø—É—Å—Ç–∞—è"
            )
    
    def calculate_score(self):
        """–í—ã—á–∏—Å–ª–µ–Ω–∏–µ –∏—Ç–æ–≥–æ–≤–æ–≥–æ —Å–∫–æ—Ä–∞ –∫–∞—á–µ—Å—Ç–≤–∞"""
        total_checks = 6
        passed_checks = total_checks - len(self.errors)
        
        score = (passed_checks / total_checks) * 100
        
        # –®—Ç—Ä–∞—Ñ—ã –∑–∞ warnings
        score -= len(self.warnings) * 5
        
        return max(0, min(100, score))
    
    @staticmethod
    def _validate_cell_reference(ref):
        """–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ —Å—Å—ã–ª–∫–∏ –Ω–∞ —è—á–µ–π–∫—É"""
        import re
        # –§–æ—Ä–º–∞—Ç: "–û–∫—Ç—è–±—Ä—å 2025!C15" –∏–ª–∏ "–û–∫—Ç—è–±—Ä—å 2025!C15:D20"
        pattern = r'^[–ê-–Ø–∞-—èA-Za-z0-9\s]+![A-Z]+\d+(:[A-Z]+\d+)?$'
        return bool(re.match(pattern, ref))
```

---

## üîÑ –î–≤—É—Ö–∏—Ç–µ—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

```python
class TwoStageValidator:
    """–í–∞–ª–∏–¥–∞—Ç–æ—Ä —Å –¥–≤—É–º—è –∏—Ç–µ—Ä–∞—Ü–∏—è–º–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏"""
    
    def __init__(self, report_generator):
        self.generator = report_generator
        self.iteration = 0
        self.max_iterations = 2
    
    def validate_with_retry(self):
        """
        –ò—Ç–µ—Ä–∞—Ü–∏—è 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ + –∞–≤—Ç–æ–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
        –ò—Ç–µ—Ä–∞—Ü–∏—è 2: –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
        """
        
        for self.iteration in range(1, self.max_iterations + 1):
            print(f"\n{'='*60}")
            print(f"–ò–¢–ï–†–ê–¶–ò–Ø {self.iteration}: –°–∞–º–æ–ø—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç—á–µ—Ç–∞")
            print(f"{'='*60}\n")
            
            # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –æ—Ç—á–µ—Ç
            report_data = self.generator.generate()
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º
            validator = ReportValidator(report_data)
            result = validator.validate_all()
            
            # –í—ã–≤–æ–¥–∏–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
            self._print_validation_results(result)
            
            # –ï—Å–ª–∏ –≤—Å—ë –û–ö - –≤—ã—Ö–æ–¥–∏–º
            if result['passed'] and len(result['warnings']) == 0:
                print("\n‚úÖ –í–°–ï –ü–†–û–í–ï–†–ö–ò –ü–†–û–ô–î–ï–ù–´!")
                return result
            
            # –ï—Å–ª–∏ –∏—Ç–µ—Ä–∞—Ü–∏—è 1 - –ø—ã—Ç–∞–µ–º—Å—è –∏—Å–ø—Ä–∞–≤–∏—Ç—å
            if self.iteration == 1 and result['errors']:
                print("\nüîß –ü–æ–ø—ã—Ç–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—à–∏–±–æ–∫...")
                self._auto_fix_errors(report_data, result['errors'])
            
            # –ï—Å–ª–∏ –∏—Ç–µ—Ä–∞—Ü–∏—è 2 –∏ –µ—Å—Ç—å –æ—à–∏–±–∫–∏ - —Å–æ–æ–±—â–∞–µ–º –º–µ–Ω–µ–¥–∂–µ—Ä—É
            if self.iteration == 2 and (result['errors'] or result['warnings']):
                print("\n‚ö†Ô∏è –ü–û–°–õ–ï 2 –ò–¢–ï–†–ê–¶–ò–ô –û–°–¢–ê–õ–ò–°–¨ –ü–†–û–ë–õ–ï–ú–´")
                return result
        
        return result
    
    def _print_validation_results(self, result):
        """–í—ã–≤–æ–¥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø—Ä–æ–≤–µ—Ä–∫–∏"""
        print(f"üìä –†–ï–ó–£–õ–¨–¢–ê–¢–´ –ü–†–û–í–ï–†–ö–ò:")
        print(f"   –°—Ç–∞—Ç—É—Å: {'‚úÖ –ü–†–û–ô–î–ï–ù–û' if result['passed'] else '‚ùå –ù–ï –ü–†–û–ô–î–ï–ù–û'}")
        print(f"   –û—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞: {result['score']:.1f}/100\n")
        
        if result['errors']:
            print(f"‚ùå –ö–†–ò–¢–ò–ß–ù–´–ï –û–®–ò–ë–ö–ò ({len(result['errors'])}):")
            for i, error in enumerate(result['errors'], 1):
                print(f"   {i}. {error}")
            print()
        
        if result['warnings']:
            print(f"‚ö†Ô∏è –ü–†–ï–î–£–ü–†–ï–ñ–î–ï–ù–ò–Ø ({len(result['warnings'])}):")
            for i, warning in enumerate(result['warnings'], 1):
                print(f"   {i}. {warning}")
            print()
    
    def _auto_fix_errors(self, report_data, errors):
        """–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫"""
        for error in errors:
            if '–ê–Ω–æ–º–∞–ª—å–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ' in error:
                # –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–Ω–æ–º–∞–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
                self._fix_anomalous_values(report_data)
            
            elif '–û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ' in error:
                # –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
                self._fix_negative_values(report_data)
            
            elif '–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Å—Å—ã–ª–∫–∞' in error:
                # –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Å—ã–ª–æ–∫
                self._fix_invalid_references(report_data)
    
    def _fix_anomalous_values(self, report_data):
        """–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–Ω–æ–º–∞–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π (>200%)"""
        for metric in report_data.get('metrics', []):
            if abs(metric.get('change_percent', 0)) > 200:
                # –í–µ—Ä–æ—è—Ç–Ω–æ –æ—à–∏–±–∫–∞ –≤ –ø–∞—Ä—Å–∏–Ω–≥–µ –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤
                # –ü–æ–ø—ã—Ç–∫–∞ –ø–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å
                if metric.get('today_value') and metric.get('yesterday_value'):
                    yesterday = metric['yesterday_value']
                    today = metric['today_value']
                    
                    if yesterday != 0:
                        correct_change = ((today - yesterday) / yesterday) * 100
                        metric['change_percent'] = correct_change
                        print(f"   ‚úì –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: {metric['name']} = {correct_change:.1f}%")
```

---

## üìä –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä 1: –ü—Ä–æ—Å—Ç–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

```python
# –î–∞–Ω–Ω—ã–µ –æ—Ç—á–µ—Ç–∞
report_data = {
    'today_date': '15.10.2025',
    'yesterday_date': '14.10.2025',
    'sheet_name': '–û–∫—Ç—è–±—Ä—å 2025',
    'metrics': [
        {
            'name': 'CR',
            'today_value': 0.78,
            'yesterday_value': 1.02,
            'change_percent': -23.5,
            'severity': 'critical',
            'source': '–û–∫—Ç—è–±—Ä—å 2025!C15',
            'recommendation': '–°–Ω–∏–∑–∏—Ç—å —Ü–µ–Ω—É –Ω–∞ 10-12%',
            'rule_id': 'R005'
        },
        # ... –¥—Ä—É–≥–∏–µ –º–µ—Ç—Ä–∏–∫–∏
    ],
    'report_markdown': '# –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –∞–Ω–∞–ª–∏–∑: 15 –æ–∫—Ç—è–±—Ä—è 2025\n...'
}

# –ü—Ä–æ–≤–µ—Ä–∫–∞
validator = ReportValidator(report_data)
result = validator.validate_all()

if result['passed']:
    print("‚úÖ –û—Ç—á–µ—Ç –≥–æ—Ç–æ–≤ –∫ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏!")
else:
    print(f"‚ùå –ù–∞–π–¥–µ–Ω–æ –æ—à–∏–±–æ–∫: {len(result['errors'])}")
    for error in result['errors']:
        print(f"  - {error}")
```

### –ü—Ä–∏–º–µ—Ä 2: –î–≤—É—Ö–∏—Ç–µ—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

```python
# –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –æ—Ç—á–µ—Ç–∞
class ReportGenerator:
    def generate(self):
        # –õ–æ–≥–∏–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç—á–µ—Ç–∞
        return report_data

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å –∞–≤—Ç–æ–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º
generator = ReportGenerator()
validator = TwoStageValidator(generator)

result = validator.validate_with_retry()

if result['score'] >= 95:
    print("\n‚úÖ –ö–ê–ß–ï–°–¢–í–û –û–¢–ß–ï–¢–ê: –û–¢–õ–ò–ß–ù–û")
    print("–ú–æ–∂–Ω–æ –ø—É—à–∏—Ç—å –≤ GitHub")
elif result['score'] >= 80:
    print("\n‚ö†Ô∏è –ö–ê–ß–ï–°–¢–í–û –û–¢–ß–ï–¢–ê: –•–û–†–û–®–û")
    print("–ï—Å—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è, –Ω–æ –º–æ–∂–Ω–æ –ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å")
else:
    print("\n‚ùå –ö–ê–ß–ï–°–¢–í–û –û–¢–ß–ï–¢–ê: –ù–ï–î–û–°–¢–ê–¢–û–ß–ù–û")
    print("–¢—Ä–µ–±—É–µ—Ç—Å—è –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–æ –º–µ–Ω–µ–¥–∂–µ—Ä–∞")
```

---

## üéØ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –∫–∞—á–µ—Å—Ç–≤–∞

### –û—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ –æ—Ç—á–µ—Ç–∞

| –ë–∞–ª–ª | –°—Ç–∞—Ç—É—Å | –î–µ–π—Å—Ç–≤–∏–µ |
|------|--------|----------|
| **95-100** | ‚úÖ –û—Ç–ª–∏—á–Ω–æ | –ê–≤—Ç–æ–ø—É–±–ª–∏–∫–∞—Ü–∏—è —Ä–∞–∑—Ä–µ—à–µ–Ω–∞ |
| **80-94** | ‚ö†Ô∏è –•–æ—Ä–æ—à–æ | –ü—É–±–ª–∏–∫–∞—Ü–∏—è —Å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è–º–∏ |
| **60-79** | üî∂ –£–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ | –¢—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –º–µ–Ω–µ–¥–∂–µ—Ä–∞ |
| **<60** | ‚ùå –ü–ª–æ—Ö–æ | –ü—É–±–ª–∏–∫–∞—Ü–∏—è –∑–∞–ø—Ä–µ—â–µ–Ω–∞ |

### –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –ø—Ä–æ–±–ª–µ–º

**–ö–†–ò–¢–ò–ß–ù–´–ï –û–®–ò–ë–ö–ò (–±–ª–æ–∫–∏—Ä—É—é—Ç –ø—É–±–ª–∏–∫–∞—Ü–∏—é):**
- –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –¥–∞—Ç—ã
- –ê–Ω–æ–º–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è (>200%)
- –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–∏
- –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º
- –ù–∞—Ä—É—à–µ–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Ç—á–µ—Ç–∞

**–ü–†–ï–î–£–ü–†–ï–ñ–î–ï–ù–ò–Ø (–Ω–µ –±–ª–æ–∫–∏—Ä—É—é—Ç, –Ω–æ —Å–Ω–∏–∂–∞—é—Ç –æ—Ü–µ–Ω–∫—É):**
- –ú–∞–ª–æ –º–µ—Ç—Ä–∏–∫ (<30)
- –ë–æ–ª—å—à–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è (>100%)
- –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –Ω–µ–∫—Ä–∏—Ç–∏—á–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏
- –ù–µ—Ç —Å—Å—ã–ª–æ–∫ –Ω–∞ –ø—Ä–∞–≤–∏–ª–∞
- –ü—É—Å—Ç—ã–µ —Å–µ–∫—Ü–∏–∏

---

## üìù –®–∞–±–ª–æ–Ω –≤—ã–≤–æ–¥–∞ —Å–∞–º–æ–ø—Ä–æ–≤–µ—Ä–∫–∏

### –í –æ—Ç—á–µ—Ç –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è —Å–µ–∫—Ü–∏—è:

```markdown
## ‚úÖ –°–∞–º–æ–ø—Ä–æ–≤–µ—Ä–∫–∞ –∞–≥–µ–Ω—Ç–∞

**–ò—Ç–µ—Ä–∞—Ü–∏—è 1 (09:14:30):**
- ‚úì –î–∞—Ç—ã –Ω–∞–π–¥–µ–Ω—ã: 14.10, 15.10
- ‚úì –ú–µ—Ç—Ä–∏–∫ –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ: 32/32
- ‚úì –î–∏–∞–ø–∞–∑–æ–Ω –∑–Ω–∞—á–µ–Ω–∏–π: –≤—Å–µ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö ¬±100%
- ‚úì –°—Å—ã–ª–∫–∏ –Ω–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–∏: 32/32 –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã
- ‚ö†Ô∏è –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: CR –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å 235% –Ω–∞ 23.5% (–æ—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞)

**–ò—Ç–µ—Ä–∞—Ü–∏—è 2 (09:14:45):**
- ‚úì –í—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–π–¥–µ–Ω—ã
- ‚úì –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã
- ‚úì –ö–∞—á–µ—Å—Ç–≤–æ –æ—Ç—á–µ—Ç–∞: 98/100
- ‚úÖ **–ì–û–¢–û–í –ö –ü–£–ë–õ–ò–ö–ê–¶–ò–ò**

**–î–µ—Ç–∞–ª–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏:**
- –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤: 15
- –ü—Ä–æ–π–¥–µ–Ω–æ: 15
- –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π: 0
- –û—à–∏–±–æ–∫: 0 (–±—ã–ª–æ 1, –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ)
```

---

## üîß –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ workflow

### –ú–µ—Å—Ç–æ –≤ workflow –∞–≥–µ–Ω—Ç–∞:

```
1. –ê–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö –∏–∑ Google Sheets
2. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª –∏–∑ –ª–∏—Å—Ç–∞ "rules"
3. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —á–µ—Ä–Ω–æ–≤–∏–∫–∞ –æ—Ç—á–µ—Ç–∞
   ‚Üì
4. üîç –°–ê–ú–û–ü–†–û–í–ï–†–ö–ê (–ò—Ç–µ—Ä–∞—Ü–∏—è 1)
   ‚îú‚îÄ –ü—Ä–æ–≥—Ä–∞–º–º–Ω—ã–µ —á–µ–∫–ª–∏—Å—Ç—ã
   ‚îú‚îÄ –ê–≤—Ç–æ–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫
   ‚îî‚îÄ –ï—Å–ª–∏ OK ‚Üí –ø–µ—Ä–µ—Ö–æ–¥ –∫ —à–∞–≥—É 6
   ‚Üì
5. üîç –°–ê–ú–û–ü–†–û–í–ï–†–ö–ê (–ò—Ç–µ—Ä–∞—Ü–∏—è 2)
   ‚îú‚îÄ –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
   ‚îî‚îÄ –ï—Å–ª–∏ NOT OK ‚Üí –≤–æ–ø—Ä–æ—Å—ã –º–µ–Ω–µ–¥–∂–µ—Ä—É
   ‚Üì
6. ‚úÖ –§–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç –≥–æ—Ç–æ–≤
7. üí¨ –ü–æ–∫–∞–∑–∞—Ç—å —Å–∞–º–º–∞—Ä–∏ –º–µ–Ω–µ–¥–∂–µ—Ä—É
8. ü§î –°–ø—Ä–æ—Å–∏—Ç—å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –Ω–∞ Git push
9. üöÄ Git push (–ø–æ—Å–ª–µ –æ–¥–æ–±—Ä–µ–Ω–∏—è)
```

---

## üí° –ü—Ä–∏–º–µ—Ä—ã –∞–≤—Ç–æ–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

### 1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–Ω–æ–º–∞–ª—å–Ω—ã—Ö –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤

**–û–±–Ω–∞—Ä—É–∂–µ–Ω–æ:**
```
CR: –≤—á–µ—Ä–∞ 1.02, —Å–µ–≥–æ–¥–Ω—è 0.78
–ò–∑–º–µ–Ω–µ–Ω–∏–µ: -1500% ‚ùå (–æ—à–∏–±–∫–∞!)
```

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:**
```python
correct_change = ((0.78 - 1.02) / 1.02) * 100
# = -23.5% ‚úÖ
```

### 2. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π

**–û–±–Ω–∞—Ä—É–∂–µ–Ω–æ:**
```
–ü–æ–∫–∞–∑—ã: -15,204 ‚ùå
```

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:**
```python
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ —á–∏—Å–ª–æ –±—ã–ª–æ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ä–∞—Å–ø–∞—Ä—Å–µ–Ω–æ
if value < 0 and metric_type in ['–ø–æ–∫–∞–∑—ã', '–∫–ª–∏–∫–∏']:
    value = abs(value)  # 15,204 ‚úÖ
```

### 3. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Å—ã–ª–æ–∫

**–û–±–Ω–∞—Ä—É–∂–µ–Ω–æ:**
```
–ò—Å—Ç–æ—á–Ω–∏–∫: "–û–∫—Ç—è–±—Ä—å!C" ‚ùå (–Ω–µ–ø–æ–ª–Ω–∞—è —Å—Å—ã–ª–∫–∞)
```

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:**
```python
# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–ª–Ω–æ–π —Å—Å—ã–ª–∫–∏ –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
source = f"{sheet_name}!{column}{row}"
# "–û–∫—Ç—è–±—Ä—å 2025!C15" ‚úÖ
```

---

## üöÄ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!

–≠—Ç–æ—Ç —à–∞–±–ª–æ–Ω –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç:
- ‚úÖ **–ü—Ä–æ–≥—Ä–∞–º–º–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏** –≤–º–µ—Å—Ç–æ "LLM –¥—É–º–∞–µ—Ç —á—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏–ª"
- ‚úÖ **–ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏** –¥–ª—è –∫–∞–∂–¥–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏
- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ** –ø—Ä–æ—Å—Ç—ã—Ö –æ—à–∏–±–æ–∫
- ‚úÖ **–î–≤—É—Ö–∏—Ç–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥** –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏
- ‚úÖ **–û—Ü–µ–Ω–∫—É –∫–∞—á–µ—Å—Ç–≤–∞** (0-100 –±–∞–ª–ª–æ–≤)
- ‚úÖ **–ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å** —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –¥–ª—è –º–µ–Ω–µ–¥–∂–µ—Ä–∞

---

**–í–µ—Ä—Å–∏—è:** 1.0  
**–î–∞—Ç–∞:** 15 –æ–∫—Ç—è–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** –ì–æ—Ç–æ–≤ –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –≤ v2.0

